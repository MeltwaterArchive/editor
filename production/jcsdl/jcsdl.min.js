
(typeof Crypto=="undefined"||!Crypto.util)&&function(){var m=window.Crypto={},o=m.util={rotl:function(h,g){return h<<g|h>>>32-g},rotr:function(h,g){return h<<32-g|h>>>g},endian:function(h){if(h.constructor==Number)return o.rotl(h,8)&16711935|o.rotl(h,24)&4278255360;for(var g=0;g<h.length;g++)h[g]=o.endian(h[g]);return h},randomBytes:function(h){for(var g=[];h>0;h--)g.push(Math.floor(Math.random()*256));return g},bytesToWords:function(h){for(var g=[],i=0,a=0;i<h.length;i++,a+=8)g[a>>>5]|=(h[i]&255)<<24-a%32;return g},wordsToBytes:function(h){for(var g=[],i=0;i<h.length*32;i+=8)g.push(h[i>>>5]>>>24-i%32&255);return g},bytesToHex:function(h){for(var g=[],i=0;i<h.length;i++)g.push((h[i]>>>4).toString(16)),g.push((h[i]&15).toString(16));return g.join("")},hexToBytes:function(h){for(var g=[],i=0;i<h.length;i+=2)g.push(parseInt(h.substr(i,2),16));return g},bytesToBase64:function(h){if(typeof btoa=="function")return btoa(n.bytesToString(h));for(var g=[],i=0;i<h.length;i+=3)for(var a=h[i]<<16|h[i+1]<<8|h[i+2],b=0;b<4;b++)i*8+b*6<=h.length*8?g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-b)&63)):g.push("=");return g.join("")},base64ToBytes:function(h){if(typeof atob=="function")return n.stringToBytes(atob(h));for(var h=h.replace(/[^A-Z0-9+\/]/ig,""),g=[],i=0,a=0;i<h.length;a=++i%4)a!=0&&g.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<a*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i))>>>6-a*2);return g}},m=m.charenc={};m.UTF8={stringToBytes:function(h){return n.stringToBytes(unescape(encodeURIComponent(h)))},bytesToString:function(h){return decodeURIComponent(escape(n.bytesToString(h)))}};var n=m.Binary={stringToBytes:function(h){for(var g=[],i=0;i<h.length;i++)g.push(h.charCodeAt(i)&255);return g},bytesToString:function(h){for(var g=[],i=0;i<h.length;i++)g.push(String.fromCharCode(h[i]));return g.join("")}}}();(function(){var m=Crypto,o=m.util,n=m.charenc,h=n.UTF8,g=n.Binary,i=m.MD5=function(a,b){var h=o.wordsToBytes(i._md5(a));return b&&b.asBytes?h:b&&b.asString?g.bytesToString(h):o.bytesToHex(h)};i._md5=function(a){a.constructor==String&&(a=h.stringToBytes(a));for(var b=o.bytesToWords(a),g=a.length*8,a=1732584193,d=-271733879,e=-1732584194,c=271733878,f=0;f<b.length;f++)b[f]=(b[f]<<8|b[f]>>>24)&16711935|(b[f]<<24|b[f]>>>8)&4278255360;b[g>>>5]|=128<<g%32;b[(g+64>>>9<<4)+14]=g;for(var g=i._ff,j=i._gg,k=i._hh,l=i._ii,f=0;f<b.length;f+=16)var m=a,n=d,p=e,q=c,a=g(a,d,e,c,b[f+0],7,-680876936),c=g(c,a,d,e,b[f+1],12,-389564586),e=g(e,c,a,d,b[f+2],17,606105819),d=g(d,e,c,a,b[f+3],22,-1044525330),a=g(a,d,e,c,b[f+4],7,-176418897),c=g(c,a,d,e,b[f+5],12,1200080426),e=g(e,c,a,d,b[f+6],17,-1473231341),d=g(d,e,c,a,b[f+7],22,-45705983),a=g(a,d,e,c,b[f+8],7,1770035416),c=g(c,a,d,e,b[f+9],12,-1958414417),e=g(e,c,a,d,b[f+10],17,-42063),d=g(d,e,c,a,b[f+11],22,-1990404162),a=g(a,d,e,c,b[f+12],7,1804603682),c=g(c,a,d,e,b[f+13],12,-40341101),e=g(e,c,a,d,b[f+14],17,-1502002290),d=g(d,e,c,a,b[f+15],22,1236535329),a=j(a,d,e,c,b[f+1],5,-165796510),c=j(c,a,d,e,b[f+6],9,-1069501632),e=j(e,c,a,d,b[f+11],14,643717713),d=j(d,e,c,a,b[f+0],20,-373897302),a=j(a,d,e,c,b[f+5],5,-701558691),c=j(c,a,d,e,b[f+10],9,38016083),e=j(e,c,a,d,b[f+15],14,-660478335),d=j(d,e,c,a,b[f+4],20,-405537848),a=j(a,d,e,c,b[f+9],5,568446438),c=j(c,a,d,e,b[f+14],9,-1019803690),e=j(e,c,a,d,b[f+3],14,-187363961),d=j(d,e,c,a,b[f+8],20,1163531501),a=j(a,d,e,c,b[f+13],5,-1444681467),c=j(c,a,d,e,b[f+2],9,-51403784),e=j(e,c,a,d,b[f+7],14,1735328473),d=j(d,e,c,a,b[f+12],20,-1926607734),a=k(a,d,e,c,b[f+5],4,-378558),c=k(c,a,d,e,b[f+8],11,-2022574463),e=k(e,c,a,d,b[f+11],16,1839030562),d=k(d,e,c,a,b[f+14],23,-35309556),a=k(a,d,e,c,b[f+1],4,-1530992060),c=k(c,a,d,e,b[f+4],11,1272893353),e=k(e,c,a,d,b[f+7],16,-155497632),d=k(d,e,c,a,b[f+10],23,-1094730640),a=k(a,d,e,c,b[f+13],4,681279174),c=k(c,a,d,e,b[f+0],11,-358537222),e=k(e,c,a,d,b[f+3],16,-722521979),d=k(d,e,c,a,b[f+6],23,76029189),a=k(a,d,e,c,b[f+9],4,-640364487),c=k(c,a,d,e,b[f+12],11,-421815835),e=k(e,c,a,d,b[f+15],16,530742520),d=k(d,e,c,a,b[f+2],23,-995338651),a=l(a,d,e,c,b[f+0],6,-198630844),c=l(c,a,d,e,b[f+7],10,1126891415),e=l(e,c,a,d,b[f+14],15,-1416354905),d=l(d,e,c,a,b[f+5],21,-57434055),a=l(a,d,e,c,b[f+12],6,1700485571),c=l(c,a,d,e,b[f+3],10,-1894986606),e=l(e,c,a,d,b[f+10],15,-1051523),d=l(d,e,c,a,b[f+1],21,-2054922799),a=l(a,d,e,c,b[f+8],6,1873313359),c=l(c,a,d,e,b[f+15],10,-30611744),e=l(e,c,a,d,b[f+6],15,-1560198380),d=l(d,e,c,a,b[f+13],21,1309151649),a=l(a,d,e,c,b[f+4],6,-145523070),c=l(c,a,d,e,b[f+11],10,-1120210379),e=l(e,c,a,d,b[f+2],15,718787259),d=l(d,e,c,a,b[f+9],21,-343485551),a=a+m>>>0,d=d+n>>>0,e=e+p>>>0,c=c+q>>>0;return o.endian([a,d,e,c])};i._ff=function(a,b,g,d,e,c,f){a=a+(b&g|~b&d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._gg=function(a,b,g,d,e,c,f){a=a+(b&d|g&~d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._hh=function(a,b,g,d,e,c,f){a=a+(b^g^d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._ii=function(a,b,g,d,e,c,f){a=a+(g^(b|~d))+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._blocksize=16;i._digestsize=16})();

(function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;return!b.href||!g||f.nodeName.toLowerCase()!=="map"?!1:(h=a("img[usemap=#"+g+"]")[0],!!h&&d(h))}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(a.ui.version)return;a.extend(a.ui,{version:"1.8.20",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function h(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?g["inner"+d].call(this):this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?g["outer"+d].call(this,b):this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!d||!a.element[0].parentNode)return;for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}})})(jQuery);;(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&e.charAt(0)==="_"?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b)return h=f,!1}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);;(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(c)return;this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted)return b.preventDefault(),!0}return!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||!!b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);;(function(a,b){var c=5;a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=d.values&&d.values.length||1,h=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(d.disabled?" ui-slider-disabled ui-disabled":"")),this.range=a([]),d.range&&(d.range===!0&&(d.values||(d.values=[this._valueMin(),this._valueMin()]),d.values.length&&d.values.length!==2&&(d.values=[d.values[0],d.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(d.range==="min"||d.range==="max"?" ui-slider-range-"+d.range:"")));for(var i=e.length;i<g;i+=1)h.push(f);this.handles=e.add(a(h.join("")).appendTo(b.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){d.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){d.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")}),this.handles.each(function(b){a(this).data("index.ui-slider-handle",b)}),this.handles.keydown(function(d){var e=a(this).data("index.ui-slider-handle"),f,g,h,i;if(b.options.disabled)return;switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:d.preventDefault();if(!b._keySliding){b._keySliding=!0,a(this).addClass("ui-state-active"),f=b._start(d,e);if(f===!1)return}}i=b.options.step,b.options.values&&b.options.values.length?g=h=b.values(e):g=h=b.value();switch(d.keyCode){case a.ui.keyCode.HOME:h=b._valueMin();break;case a.ui.keyCode.END:h=b._valueMax();break;case a.ui.keyCode.PAGE_UP:h=b._trimAlignValue(g+(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.PAGE_DOWN:h=b._trimAlignValue(g-(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(g===b._valueMax())return;h=b._trimAlignValue(g+i);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(g===b._valueMin())return;h=b._trimAlignValue(g-i)}b._slide(d,e,h)}).keyup(function(c){var d=a(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,d),b._change(c,d),a(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options,d,e,f,g,h,i,j,k,l;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),d={x:b.pageX,y:b.pageY},e=this._normValueFromMouse(d),f=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(b){var c=Math.abs(e-h.values(b));f>c&&(f=c,g=a(this),i=b)}),c.range===!0&&this.values(1)===c.min&&(i+=1,g=a(this.handles[i])),j=this._start(b,i),j===!1?!1:(this._mouseSliding=!0,h._handleIndex=i,g.addClass("ui-state-active").focus(),k=g.offset(),l=!a(b.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:b.pageX-k.left-g.width()/2,top:b.pageY-k.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,i,e),this._animateOff=!0,!0))},_mouseStart:function(a){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return this.orientation==="horizontal"?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),this.orientation==="vertical"&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),this.options.values.length===2&&this.options.range===!0&&(b===0&&c>d||b===1&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("change",a,c)}},value:function(a){if(arguments.length){this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(b,c){var d,e,f;if(arguments.length>1){this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b);return}if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();d=this.options.values,e=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a),a},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b),b;c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return Math.abs(c)*2>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b=this.options.range,c=this.options,d=this,e=this._animateOff?!1:c.animate,f,g={},h,i,j,k;this.options.values&&this.options.values.length?this.handles.each(function(b,i){f=(d.values(b)-d._valueMin())/(d._valueMax()-d._valueMin())*100,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",a(this).stop(1,1)[e?"animate":"css"](g,c.animate),d.options.range===!0&&(d.orientation==="horizontal"?(b===0&&d.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({width:f-h+"%"},{queue:!1,duration:c.animate})):(b===0&&d.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({height:f-h+"%"},{queue:!1,duration:c.animate}))),h=f}):(i=this.value(),j=this._valueMin(),k=this._valueMax(),f=k!==j?(i-j)/(k-j)*100:0,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](g,c.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},c.animate),b==="max"&&this.orientation==="horizontal"&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},c.animate),b==="max"&&this.orientation==="vertical"&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}}),a.extend(a.ui.slider,{version:"1.8.20"})})(jQuery);;

(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}
var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}
event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}
mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}
touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}
this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}
simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}
touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};})(jQuery);

(function($){function fixTitle($ele){if($ele.attr('title')||typeof($ele.attr('original-title'))!='string'){$ele.attr('original-title',$ele.attr('title')||'').removeAttr('title');}}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;fixTitle(this.$element);}
Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;var gravity=(typeof this.options.gravity=='function')?this.options.gravity.call(this.$element[0]):this.options.gravity;var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){return this.data('tipsy')[options]();}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.8,title:'title',trigger:'hover'};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};})(jQuery);
;(function($){$.fn.extend({simulate:function(type,options){return this.each(function(){var opt=$.extend({},$.simulate.defaults,options||{});new $.simulate(this,type,opt);});}});$.simulate=function(el,type,options){this.target=el;this.options=options;if(/^drag$/.test(type)){this[type].apply(this,[this.target,options]);}else{this.simulateEvent(el,type,options);}}
$.extend($.simulate.prototype,{simulateEvent:function(el,type,options){var evt=this.createEvent(type,options);this.dispatchEvent(el,type,evt,options);return evt;},createEvent:function(type,options){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(type)){return this.mouseEvent(type,options);}else if(/^key(up|down|press)$/.test(type)){return this.keyboardEvent(type,options);}},mouseEvent:function(type,options){var evt;var e=$.extend({bubbles:true,cancelable:(type!="mousemove"),view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},options);var relatedTarget=$(e.relatedTarget)[0];if($.isFunction(document.createEvent)){evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget||document.body.parentNode);}else if(document.createEventObject){evt=document.createEventObject();$.extend(evt,e);evt.button={0:1,1:4,2:2}[evt.button]||evt.button;}
return evt;},keyboardEvent:function(type,options){var evt;var e=$.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},options);if($.isFunction(document.createEvent)){try{evt=document.createEvent("KeyEvents");evt.initKeyEvent(type,e.bubbles,e.cancelable,e.view,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);}catch(err){evt=document.createEvent("Events");evt.initEvent(type,e.bubbles,e.cancelable);$.extend(evt,{view:e.view,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,keyCode:e.keyCode,charCode:e.charCode});}}else if(document.createEventObject){evt=document.createEventObject();$.extend(evt,e);}
if($.browser.msie||$.browser.opera){evt.keyCode=(e.charCode>0)?e.charCode:e.keyCode;evt.charCode=undefined;}
return evt;},dispatchEvent:function(el,type,evt){if(el.dispatchEvent){el.dispatchEvent(evt);}else if(el.fireEvent){el.fireEvent('on'+type,evt);}
return evt;},drag:function(el){var self=this,center=this.findCenter(this.target),options=this.options,x=Math.floor(center.x),y=Math.floor(center.y),dx=options.dx||0,dy=options.dy||0,target=this.target;var coord={clientX:x,clientY:y};this.simulateEvent(target,"mousedown",coord);coord={clientX:x+1,clientY:y+1};this.simulateEvent(document,"mousemove",coord);coord={clientX:x+dx,clientY:y+dy};this.simulateEvent(document,"mousemove",coord);this.simulateEvent(document,"mousemove",coord);this.simulateEvent(target,"mouseup",coord);},findCenter:function(el){var el=$(this.target),o=el.offset();return{x:o.left+el.outerWidth()/2,y:o.top+el.outerHeight()/2};}});$.extend($.simulate,{defaults:{speed:'sync'},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40});})(jQuery);

var JCSDLParser=function(gui){this.gui=gui;};JCSDLParser.prototype={v:'1.0',parseJCSDL:function(code){var lines=code.split("\n");var masterLine=lines.shift();var endLine=lines.pop();if(!this.verifyJCSDL(masterLine,lines)){this.error('The given JCSDL did not verify!',code);return false;}
var versionLine=lines.shift();var logic=masterLine.split(' ')[3];var filters=[];while(lines.length>0){var jcsdlDescription=lines.shift();var csdl=lines.shift();var jcsdlEnd=lines.shift();lines.shift();jcsdlDescription=jcsdlDescription.split(' ');var jcsdlHash=jcsdlDescription[2];var jcsdlCode=jcsdlDescription[3];if(!this.verifyJCSDLFilter(jcsdlHash,csdl)){this.error('The given JCSDL Filter code did not verify!',csdl,code);return false;}
var filter=this.filterFromJCSDL(jcsdlCode,csdl);filters.push(filter);}
return{filters:filters,logic:logic};},filterFromJCSDL:function(jcsdlCode,csdl){jcsdlCode=jcsdlCode.split(',');var fieldPath=jcsdlCode.shift().split('.');var target=fieldPath.shift();var fieldInfo=this.getFieldInfo(target,fieldPath);if(fieldInfo===false)return false;var operator=jcsdlCode.shift();var value='';var additional={cs:false};if(operator!=='exists'){var range=jcsdlCode.shift().split('-');value=this.valueFromCSDL(fieldInfo,csdl.substr(range[0],range[1]),operator);$.each(jcsdlCode,function(i,code){switch(code){case'cs':additional.cs=true;break;}});}
var filter=this.createFilter(target,fieldPath,operator,value,additional);return filter;},getJCSDLForFilters:function(filters,logic){var self=this;var logic=(logic)?logic:'AND';logic=(logic=='AND'||logic=='OR')?logic:'AND';var filterCodes=[];$.each(filters,function(i,filter){var parsedFilter=self.filterToCSDL(filter);if(!parsedFilter)return true;filterCodes.push(parsedFilter);});var output='// JCSDL_VERSION '+this.v+"\n"+filterCodes.join("\n"+logic+"\n");var hash=this.encodeJCSDL(output,logic);output='// JCSDL_MASTER '+hash+' '+logic+"\n"+output+"\n// JCSDL_MASTER_END";return output;},filterToCSDL:function(filter){var fieldInfo=this.getFieldInfo(filter.target,filter.fieldPath);if(fieldInfo===false)return false;var value=this.valueToCSDL(filter.value,fieldInfo,filter.operator);if(value===false)return false;var field=this.fieldToCSDL(filter.fieldPath);if(field===false)return false;var operatorCode=this.getOperatorCode(filter.operator);if(operatorCode===false)return false;var cs=(filter.cs)?' cs':'';var csdl=((filter.target=='augmentation')?'':filter.target+'.')+field.replace('-','.')+cs+' '+operatorCode+' ';var jcsdlSyntax=filter.target+'.'+field+','+filter.operator;if(filter.operator!=='exists'){var valueStart=(fieldInfo.type=='string'||fieldInfo.type=='geo')?csdl.length+1:csdl.length;var valueLength=(fieldInfo.type=='string'||fieldInfo.type=='geo')?value.length-2:value.length;csdl=csdl+value;jcsdlSyntax+=','+valueStart+'-'+valueLength;if(filter.cs){jcsdlSyntax+=',cs';}}
var hash=this.encodeJCSDLFilter(csdl);var jcsdl_start='// JCSDL_START '+hash+' '+jcsdlSyntax;var jcsdl_end='// JCSDL_END';return jcsdl_start+"\n"+csdl+"\n"+jcsdl_end;},encodeJCSDL:function(output,logic){var hash=Crypto.MD5(logic+"\n"+output);return hash;},verifyJCSDL:function(masterLine,lines){var input=lines.join("\n");var masterInfo=masterLine.split(' ');var logic=masterInfo[3];var hash=masterInfo[2];var jcsdlHash=this.encodeJCSDL(input,logic);return(hash==jcsdlHash);},encodeJCSDLFilter:function(csdl){var hash=Crypto.MD5(csdl);return hash;},verifyJCSDLFilter:function(hash,csdl){var csdlHash=this.encodeJCSDLFilter(csdl);return(hash==csdlHash);},fieldToCSDL:function(fieldPath){return fieldPath.join('.');},valueToCSDL:function(value,fieldInfo,operator){var parsedValue='';if(fieldInfo.type=='int'){if(operator!=='in'&&isNaN(value)){this.error('This field value is suppose to be a Number, String given.',value,fieldInfo);return false;}else if(operator=='in'){value=value.split(',');$.each(value,function(i,val){value[i]==parseInt(val);});parsedValue='['+value.join(',')+']';}else{parsedValue=value;}}else{var escapeRegEx=($.inArray(operator,['regex_partial','regex_exact'])>=0)?true:false;parsedValue='"'+value.escapeCsdl(escapeRegEx)+'"';}
return parsedValue;},valueFromCSDL:function(fieldInfo,value,operator){if(fieldInfo.type=='int'){if(operator=='in'){value=value.substr(1,value.length-2);}
return value;}else{var escapeRegEx=($.inArray(operator,['regex_partial','regex_exact'])>=0)?true:false;return value.unescapeCsdl(escapeRegEx);}},error:function(message,code){this.gui.showError.apply(this.gui,arguments);},createFilter:function(target,fieldPath,operator,value,additional){additional=additional||{};var filter={target:target,fieldPath:fieldPath,operator:operator,value:value,cs:additional.cs}
return filter;},getOperatorCode:function(operatorName){return this.gui.definition.operators[operatorName].code;},getTargetInfo:function(target){if(typeof(this.gui.definition.targets[target])!=='undefined'){return this.gui.definition.targets[target];}
this.error('Such target does not exist!',target);return false;},getFieldInfo:function(target,fieldPath){var self=this;var field=this.gui.definition.targets[target];if(typeof(field)=='undefined'){this.error('Such target does not exist!',target);return false;}
$.each(fieldPath,function(i,fieldName){if(typeof(field.fields)!=='undefined'){if(typeof(field.fields[fieldName])!=='undefined'){field=field.fields[fieldName];}else{self.error('Invalid path to a field a!',target,fieldPath,field);field=false;return false;}}else{self.error('Invalid path to a field b!',target,fieldPath,field);field=false;return false;}});return field;}};

var JCSDLGuiTemplates={container:$('<div class="jcsdl-container" />'),editor:$(['<div class="jcsdl-mainview">','<div class="jcsdl-header">','<h3>Filters</h3>','<div class="jcsdl-mainview-mode">','<div class="jcsdl-label">View as:</div>','<div class="jcsdl-bordered jcsdl-mainview-mode-options">','<a href="#" class="jcsdl-mainview-mode-option jcsdl-expanded active" data-mode="expanded"></a>','<a href="#" class="jcsdl-mainview-mode-option jcsdl-collapsed" data-mode="collapsed"></a>','</div>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto"></div>','Create New Filter','</a>','</div>','</div>','<div class="jcsdl-filters-logic">','<label class="jcsdl-filters-logic-option jcsdl-and">','<input type="radio" name="logic" value="AND" checked />','ALL of the following','</label>','<label class="jcsdl-filters-logic-option jcsdl-or">','<input type="radio" name="logic" value="OR" />','ANY of the following','</label>','</div>','<div class="jcsdl-filters-list expanded">','</div>','<div class="jcsdl-footer">','<div class="jcsdl-actions">','<a href="#" class="jcsdl-button jcsdl-editor-save">Save and Preview</a>','<a href="#" class="jcsdl-button jcsdl-editor-cancel">Cancel</a>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto"></div>','Create New Filter','</a>','</div>','</div>','</div>'].join('')),filter:$(['<div class="jcsdl-filter">','<div class="jcsdl-filter-description">','<div class="jcsdl-filter-info target" />','<div class="jcsdl-filter-info field" />','<div class="jcsdl-filter-info operator" />','<div class="jcsdl-filter-info jcsdl-bordered value" />','</div>','<div class="jcsdl-filter-options">','<a href="#" class="edit">Edit</a>','<span>/</span>','<a href="#" class="delete">Delete</a>','</div>','</div>'].join('')),filterTarget:$('<div class="jcsdl-filter-target jcsdl-icon target" />'),filterField:$('<div class="jcsdl-filter-field jcsdl-icon field" />'),filterFieldInput:$(['<div class="jcsdl-filter-info input">','<div class="jcsdl-filter-field-input jcsdl-icon input" />','</div>'].join('')),filterOperator:$('<div class="jcsdl-filter-operator jcsdl-icon operator" />'),filterValue:$('<div class="jcsdl-filter-value" />'),error:$(['<div class="jcsdl-error">','<strong>Error:</strong>','<span />','</div>'].join('')),filterEditor:$(['<div class="jcsdl-filter-editor">','<div class="jcsdl-steps">','</div>','<div class="jcsdl-footer">','<a href="#" class="jcsdl-button jcsdl-filter-save">Save and Preview</a>','<span style="display: none;">or</span> <a href="#" class="jcsdl-filter-cancel">cancel</a>','</div>','</div>'].join('')),step:$('<div class="jcsdl-step" />'),target:$(['<div class="jcsdl-filter-target-wrap">','<a href="#" class="jcsdl-carousel-scroll left"></a>','<a href="#" class="jcsdl-carousel-scroll right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target jcsdl-carousel" />','</div>','</div>'].join('')),targetOption:$('<a href="#" class="jcsdl-icon target jcsdl-carousel-item"></a>'),field:$(['<div class="jcsdl-filter-target-field-wrap">','<a href="#" class="jcsdl-carousel-scroll left"></a>','<a href="#" class="jcsdl-carousel-scroll right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target-field jcsdl-carousel" />','</div>','</div>'].join('')),fieldOption:$('<a href="#" class="jcsdl-icon field jcsdl-carousel-item" />'),inputSelect:$(['<div class="jcsdl-filter-target-field-input-wrap">','<a href="#" class="jcsdl-carousel-scroll left"></a>','<a href="#" class="jcsdl-carousel-scroll right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target-field-input jcsdl-carousel" />','</div>','</div>'].join('')),inputSelectOption:$('<a href="#" class="jcsdl-icon input jcsdl-carousel-item" />'),valueInput:$(['<div class="jcsdl-filter-value-input">','<div class="jcsdl-filter-value-input-operators" />','<div class="jcsdl-filter-value-input-field" />','</div>'].join('')),operatorOption:$('<a href="#" class="jcsdl-icon operator" />'),textOperatorsSelect:$(['<div class="jcsdl-operators-select">','<div class="jcsdl-operator-label" />','<div class="jcsdl-dropdown-icon" />','</div>'].join('')),textOperatorsDropdown:$('<div class="jcsdl-dropdown jcsdl-operators-dropdown" />'),textOperatorOption:$(['<div class="jcsdl-dropdown-option">','<div class="jcsdl-icon operator" />','<a href="#" class="jcsdl-dropdown-details-trigger">?</a>','<div class="jcsdl-dropdown-option-desc">','<div class="jcsdl-operator-label">','<span /> ','<a href="#" class="jcsdl-operator-help">(?)</a>','</div>','<div class="jcsdl-operator-desc" />','</div>','</div>'].join('')),caseSensitivity:$('<a class="jcsdl-operator-cs jcsdl-icon icon-cs operator" title="Case Sensitive" />'),valueInput_text:$(['<div class="jcsdl-input-text">','<input type="text" placeholder="Type your desired value..." class="orig" />','<div class="jcsdl-containsnear-distance">','<span>Distance:</span>','<input type="text" placeholder="e.g. 0" value="2" class="dist" />','</div>','</div>'].join('')),valueInput_number:$(['<div class="jcsdl-input-number">','<input type="text" placeholder="e.g. 3.14" />','</div>'].join('')),valueInput_select:$('<div class="jcsdl-input-select" />'),valueInput_select_option:$(['<a href="#" class="jcsdl-input-select-option">','<span />','</a>'].join('')),valueInput_select_more:$('<span class="jcsdl-input-select-more">and <span class="count"></span> more...</span>'),valueInput_slider:$(['<div class="jcsdl-input-slider">','<div class="jcsdl-slider-controls">','<a href="#" class="jcsdl-slider-minus" />','<a href="#" class="jcsdl-slider-plus" />','<input type="text" name="value" class="jcsdl-slider-input" placeholder="0" />','</div>','<div class="jcsdl-slider-wrap">','<div class="jcsdl-slider-icon min" />','<div class="jcsdl-slider-icon max" />','<div class="jcsdl-slider-container">','<div class="jcsdl-slider-label min" />','<div class="jcsdl-slider-label max" />','<div class="jcsdl-slider" />','<div class="jcsdl-slider-bottom">','<div class="jcsdl-slider-bottom-left" />','<div class="jcsdl-slider-bottom-right" />','<div class="jcsdl-slider-bottom-line" />','</div>','</div>','</div>','</div>'].join('')),valueInput_geo_map:$(['<div class="jcsdl-map">','<input type="text" name="location" class="jcsdl-map-search" placeholder="Search for location..." />','<div class="jcsdl-map-canvas" />','<a href="#" class="jcsdl-clear-map">clear coordinates</a>','<p class="jcsdl-map-instructions" />','<div class="jcsdl-map-coordinates" />','<div class="jcsdl-map-area">','<label>Area:</label>','<span>0 km<sup>2</sup></span>','</div>','</div>'].join('')),valueInput_geobox:$(['<div class="jcsdl-input-geo jcsdl-geo-box" />'].join('')),valueInput_geobox_coordinates:$(['<ul>','<li class="nw"><label>NW:</label><span /></li>','<li class="ne"><label>NE:</label><span /></li>','<li class="se"><label>SE:</label><span /></li>','<li class="sw"><label>SW:</label><span /></li>','</ul>'].join('')),valueInput_georadius:$(['<div class="jcsdl-input-geo jcsdl-geo-radius" />'].join('')),valueInput_georadius_coordinates:$(['<ul>','<li class="center"><label>Center:</label><span /></li>','<li class="radius"><label>Radius:</label><span /></li>','</ul>'].join('')),valueInput_geopolygon:$(['<div class="jcsdl-input-geo jcsdl-geo-polygon" />'].join('')),valueInput_geopolygon_coordinates:$(['<ul />'].join(''))};

var JCSDLGuiInputs=function(gui){this.gui=gui;this.definition=gui.definition;};JCSDLGuiInputs.prototype={exec:function(t,m,a){return this[t][m].apply(this,a);},getTemplate:function(n){return this.gui.getTemplate(n);},text:{init:function(info){var $view=this.getTemplate('valueInput_text'),$input=$view.find('input.orig');$input.jcsdlTagInput();$input.jcsdlRegExTester();$view.find('input.dist').jcsdlNumberMask();return $view;},setValue:function($view,info,val,operator){if(operator=='contains_near'){val=val.split(':');var dist=parseInt(val.pop());$view.find('input.dist').val(dist);val=val.join(':').replace(/\\:/g,':');}
$view.find('input.orig').val(val);},getValue:function($view,info,operator){var val=$view.find('input.orig').val();if(operator=='contains_near'){val=val.replace(/:/g,'\\:')+':'+parseInt($view.find('input.dist').val());}
return val;},displayValue:function(info,val,filter){if(filter.operator=='contains_near'){val=val.split(':');var dist=parseInt(val.pop());val=val.join(':').truncate(50,'...',true).escapeHtml();return val+' : '+dist;}
return val.truncate(50,'...',true).escapeHtml();}},number:{init:function(info){var $view=this.getTemplate('valueInput_number'),fl=(info.type=='float'),arr=($.inArray('in',info.operators)>=0),$input=$view.find('input[type=text]');$input.jcsdlNumberMask(fl);if(arr){$input.jcsdlTagInput({numbers:true,floats:fl});}
return $view;},setValue:function($view,info,val,operator){$view.find('input[type=text]:first').val(val);},getValue:function($view,info,operator){return $view.find('input[type=text]:first').val();},displayValue:function(info,val,filter){if(filter.operator!=='in')return val;var fl=(info.type=='float');val=val.split(',');var show=val.slice(0,3);$.each(show,function(i,v){show[i]=(fl)?parseFloat(v).format(2):v;});var more=(show.length<val.length)?' and '+(val.length-show.length)+' more...':'';return show.join(', ')+more;}},select:{init:function(info){var self=this,$view=this.getTemplate('valueInput_select'),opts=this.exec('select','getOptionsSet',[info]);$.each(opts,function(val,lbl){self.exec('select','createOptionView',[val,lbl]).appendTo($view);});$view.find('.jcsdl-input-select-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();if(info.single){$view.find('.jcsdl-input-select-option').removeClass('selected');}
$(this).toggleClass('selected');});return $view;},setValue:function($view,info,val,operator){var vals=val.split(',');$.each(vals,function(i,v){$view.find('.jcsdl-input-select-option[data-value="'+v+'"]').addClass('selected');});},getValue:function($view,info,operator){var vals=[];$view.find('.jcsdl-input-select-option.selected').each(function(i,o){vals.push($(o).data('value'));});return vals.join(',');},displayValue:function(info,val,filter){var self=this,vals=val.split(','),$view=this.getTemplate('valueInput_select');if(vals.length==0)return $view;var opts=this.exec('select','getOptionsSet',[info]);var show=vals.slice(0,5);$.each(show,function(i,v){if(typeof(opts[v])=='undefined')return true;self.exec('select','createOptionView',[v,opts[v]]).addClass('selected').appendTo($view);});if(vals.length>show.length){var $ind=this.getTemplate('valueInput_select_more');$ind.find('.count').html(vals.length-show.length);$ind.appendTo($view);}
$view.find('.jcsdl-input-select-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();});return $view;},getOptionsSet:function(info){var opts={};if(typeof(info.options)!=='undefined'){opts=info.options;}else if((typeof(info.optionsSet)!=='undefined')&&(typeof(this.definition.inputs.select.sets[info.optionsSet])!=='undefined')){opts=this.definition.inputs.select.sets[info.optionsSet];}
return opts;},createOptionView:function(val,lbl){var $v=this.getTemplate('valueInput_select_option').attr('data-value',val).addClass('option-'+val).attr('title',lbl);$v.find('span').html(lbl);return $v;}},slider:{init:function(info){var self=this,$view=this.getTemplate('valueInput_slider'),opts=this.exec('slider','getOptions',[info]),$slider=$view.find('.jcsdl-slider').slider({animate:true,min:opts.min,max:opts.max,step:opts.step,value:opts['default'],slide:function(ev,ui){$view.find('.jcsdl-slider-input').val(self.exec('slider','parseValue',[info,ui.value]));}});this.exec('slider','setValue',[$view,info,opts['default']]);$view.find('.jcsdl-slider-label.min').html(this.exec('slider','displayValue',[info,opts.min]));$view.find('.jcsdl-slider-label.max').html(this.exec('slider','displayValue',[info,opts.max]));$view.find('.jcsdl-slider-input').jcsdlNumberMask((info.type=='float')).keyup(function(ev){if(ev.which==110||ev.which==190)return;var v=$(this).val();self.exec('slider','setValue',[$view,info,parseFloat((v)?v:0)]);});var changeValue=function($view,info,step,minus){var val=parseFloat($view.find('.jcsdl-slider-input').val());val=(minus)?val-step:val+step;self.exec('slider','setValue',[$view,info,val]);}
var interval=null;$view.find('.jcsdl-slider-minus, .jcsdl-slider-plus').bind('mousedown touchstart',function(ev){var min=$(this).is('.jcsdl-slider-minus');interval=setInterval(function(){changeValue($view,info,opts.step,min);},50);}).bind('mouseup mouseout touchend',function(ev){clearInterval(interval);}).click(function(ev){ev.preventDefault();ev.target.blur();});return $view;},setValue:function($view,info,val,operator){var opts=this.exec('slider','getOptions',[info]);val=(val>opts.max)?opts.max:((val<opts.min)?opts.min:val);$view.find('.jcsdl-slider').slider('value',val);$view.find('.jcsdl-slider-input').val(val);},getValue:function($view,info,operator){return this.exec('slider','parseValue',[info,$view.find('.jcsdl-slider-input').val()]);},displayValue:function(info,val,filter){var opts=this.exec('slider','getOptions',[info]);return opts.displayFormat.apply(opts,[val.toString()]);},parseValue:function(info,val){return val;},getOptions:function(info){return $.extend({},this.definition.inputs.slider,{min:info.min,max:info.max,step:info.step,'default':info['default'],displayFormat:info.displayFormat});}},_geo:{mapOptions:{},initSearch:function($view){var map=$view.data('map'),$ac=$view.find('.jcsdl-map-search'),ac=new google.maps.places.Autocomplete($ac[0],{});google.maps.event.addListener(ac,'place_changed',function(){var place=ac.getPlace();if(typeof(place.geometry)=='undefined'){if($('.pac-container .pac-item').length>0){$ac.trigger('focus');$ac.simulate('keydown',{keyCode:40});$ac.simulate('keydown',{keyCode:13});}
return;}
if(place.geometry.viewport){map.fitBounds(place.geometry.viewport);}else{map.setCenter(place.geometry.location);map.setZoom(17);}});},isNorth:function(c1,c2){return(c1.lat()>=c2.lat());},isEast:function(c1,c2){return(c1.lng()>=c2.lng());}},geo_box:{init:function(info){var $view=this.getTemplate('valueInput_geobox');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_geobox_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_box.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_box','load',[info,$view]]);return $view;},load:function(info,$view){var self=this,map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var rect=new google.maps.Rectangle($.extend({},this.gui.config.mapsOverlay,{}));$view.data('rect',rect);var coords=[];var mOpt={position:new google.maps.LatLng(0,0),draggable:true,icon:this.gui.config.mapsMarker};var markers=[new google.maps.Marker(mOpt),new google.maps.Marker(mOpt)];$view.data('markers',markers);this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){if(coords.length>=2)coords.pop();coords.push(ev.latLng);var m=coords.length-1;markers[m].setPosition(ev.latLng);if(!$view.data('bothMarkersVisible'))markers[m].setAnimation(google.maps.Animation.DROP);markers[m].setMap(map);if(coords.length==2){self.exec('geo_box','drawRectangle',[map,rect,coords]);$view.data('bothMarkersVisible',true);}
$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[coords.length]);$view.find('.jcsdl-clear-map').fadeIn();});google.maps.event.addListener(markers[0],'position_changed',function(){coords[0]=this.getPosition();self.exec('geo_box','drawRectangle',[map,rect,coords]);if(coords.length==2){self.exec('geo_box','updateInfo',[$view,rect]);}});google.maps.event.addListener(markers[1],'position_changed',function(){coords[1]=this.getPosition();self.exec('geo_box','drawRectangle',[map,rect,coords]);self.exec('geo_box','updateInfo',[$view,rect]);});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();coords=[];rect.setMap(null);markers[0].setMap(null);markers[1].setMap(null);$view.data('bothMarkersVisible',false);$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this,$geoView=$view.find('.jcsdl-input-geo');val=val.split(':');var nw=val[0].split(',');var se=val[1].split(',');setTimeout(function(){var map=$geoView.data('map'),rect=$geoView.data('rect'),tips=self.exec('geo_box','getAllTipsFromNWSE',[nw,se]),bounds=new google.maps.LatLngBounds(tips.sw,tips.ne);self.exec('geo_box','drawRectangleFromBounds',[map,rect,bounds]);var markers=$geoView.data('markers');markers[0].setMap(map);markers[0].setPosition(tips.ne);markers[1].setMap(map);markers[1].setPosition(tips.sw);map.fitBounds(rect.getBounds());self.exec('geo_box','updateInfo',[$geoView,rect]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[2]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var rect=$view.find('.jcsdl-input-geo').data('rect');if(!rect.getMap())return'';var tips=this.exec('geo_box','getAllTipsFromBounds',[rect.getBounds()]);return tips.nw.lat()+','+tips.nw.lng()+':'+tips.se.lat()+','+tips.se.lng();},displayValue:function(info,val,filter){val=val.split(':');var v1=val[0].split(',');var v2=val[1].split(',');return parseFloat(v1[0]).format(2)+', '+parseFloat(v1[1]).format(2)+' : '+parseFloat(v2[0]).format(2)+', '+parseFloat(v2[1]).format(2);},drawRectangle:function(map,rect,coords){if(coords.length!=2)return false;var tips=this.exec('geo_box','getAllTipsFromUnspecified',[coords[0],coords[1]]),bounds=new google.maps.LatLngBounds(tips.sw,tips.ne);this.exec('geo_box','drawRectangleFromBounds',[map,rect,bounds]);return true;},drawRectangleFromBounds:function(map,rect,bounds){rect.setBounds(bounds);rect.setMap(map);},getAllTipsFromBounds:function(bounds){var tips={};tips.ne=bounds.getNorthEast();tips.sw=bounds.getSouthWest();tips.nw=new google.maps.LatLng(tips.ne.lat(),tips.sw.lng());tips.se=new google.maps.LatLng(tips.sw.lat(),tips.ne.lng());return tips;},getAllTipsFromNWSE:function(nw,se){var tips={};tips.nw=new google.maps.LatLng(parseFloat(nw[0]),parseFloat(nw[1]));tips.se=new google.maps.LatLng(parseFloat(se[0]),parseFloat(se[1]));tips.ne=new google.maps.LatLng(tips.nw.lat(),tips.se.lng());tips.sw=new google.maps.LatLng(tips.se.lat(),tips.nw.lng());return tips;},getAllTipsFromUnspecified:function(c1,c2){var tips={},n,s,w,e;if(this._geo.isNorth(c1,c2)){n=c1;s=c2;}else{n=c2;s=c1;}
if(this._geo.isEast(c1,c2)){e=c1;w=c2;}else{e=c2;w=c1;}
var tips={nw:new google.maps.LatLng(n.lat(),w.lng()),ne:new google.maps.LatLng(n.lat(),e.lng()),se:new google.maps.LatLng(s.lat(),e.lng()),sw:new google.maps.LatLng(s.lat(),w.lng())};return tips;},updateInfo:function($view,rect){var tips=this.exec('geo_box','getAllTipsFromBounds',[rect.getBounds()]),area=google.maps.geometry.spherical.computeArea([tips.nw,tips.ne,tips.se,tips.sw]);$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');$.each(tips,function(point,coords){$view.find('.jcsdl-map-coordinates .'+point+' span').html(coords.lat().format(2)+', '+coords.lng().format(2));});}},geo_radius:{init:function(info){var $view=this.getTemplate('valueInput_georadius');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_georadius_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_radius.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_radius','load',[info,$view]]);return $view;},load:function(info,$view){var self=this;var map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var opt=$.extend({},this.gui.config.mapsOverlay,{});var circle=new google.maps.Circle(opt);$view.data('circle',circle);var markerOptions={position:new google.maps.LatLng(0,0),draggable:true,icon:this.gui.config.mapsMarker};var centerMarker=new google.maps.Marker(markerOptions);$view.data('centerMarker',centerMarker);var radiusMarker=new google.maps.Marker(markerOptions);$view.data('radiusMarker',radiusMarker);$view.data('center',false);this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){if($view.data('center')){var radius=google.maps.geometry.spherical.computeDistanceBetween(circle.getCenter(),ev.latLng);circle.setRadius(radius);circle.setMap(map);radiusMarker.setPosition(ev.latLng);radiusMarker.setMap(map);self.exec('geo_radius','updateInfo',[$view,circle]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[2]);}else{circle.setCenter(ev.latLng);centerMarker.setPosition(ev.latLng);centerMarker.setMap(map);$view.data('center',true);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[1]);}
$view.find('.jcsdl-clear-map').fadeIn();});google.maps.event.addListener(centerMarker,'position_changed',function(){var center=this.getPosition();var oldCenter=circle.getCenter();circle.setCenter(center);if(typeof(oldCenter)!=='undefined'){var latDiff=center.lat()-oldCenter.lat();var lngDiff=center.lng()-oldCenter.lng();var oldPosition=radiusMarker.getPosition();var position=new google.maps.LatLng(oldPosition.lat()+latDiff,oldPosition.lng()+lngDiff);radiusMarker.setPosition(position);}});google.maps.event.addListener(radiusMarker,'position_changed',function(){var center=circle.getCenter();if(typeof(center)!=='undefined'){circle.setRadius(google.maps.geometry.spherical.computeDistanceBetween(circle.getCenter(),this.getPosition()));self.exec('geo_radius','updateInfo',[$view,circle]);}});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();circle.setCenter(null);circle.setMap(null);centerMarker.setMap(null);radiusMarker.setMap(null);$view.data('center',false);$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this;var $geoView=$view.find('.jcsdl-input-geo');val=val.split(':');var latlng=val[0].split(',');var radius=parseFloat(val[1])*1000;setTimeout(function(){var map=$geoView.data('map');var circle=$geoView.data('circle');var center=new google.maps.LatLng(latlng[0],latlng[1])
var centerMarker=$geoView.data('centerMarker');centerMarker.setPosition(center);centerMarker.setMap(map);var radiusMarker=$geoView.data('radiusMarker');var radiusPosition=google.maps.geometry.spherical.computeOffset(center,radius,90);radiusMarker.setPosition(radiusPosition);radiusMarker.setMap(map);circle.setCenter(center);circle.setRadius(radius);circle.setMap(map);$geoView.data('center',true);map.fitBounds(circle.getBounds());self.exec('geo_radius','updateInfo',[$geoView,circle]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[2]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var circle=$view.find('.jcsdl-input-geo').data('circle');if(!circle.getMap())return'';var center=circle.getCenter();return center.lat()+','+center.lng()+':'+(circle.getRadius()/1000);},displayValue:function(info,val,filter){val=val.split(':');var center=val[0].split(',');var radius=val[1];return'Center: '+parseFloat(center[0]).format(2)+', '+parseFloat(center[1]).format(2)+'; Radius: '+parseFloat(radius).format(2)+' km';},updateInfo:function($view,circle){var r=circle.getRadius();var area=r*r*Math.PI;$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');var center=circle.getCenter();$view.find('.jcsdl-map-coordinates .center span').html(center.lat().format(2)+', '+center.lng().format(2));$view.find('.jcsdl-map-coordinates .radius span').html((circle.getRadius()/1000).format(2)+' km');}},geo_polygon:{init:function(info){var $view=this.getTemplate('valueInput_geopolygon');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_geopolygon_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_polygon.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_polygon','load',[info,$view]]);return $view;},load:function(info,$view){var self=this;var map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var opt=$.extend({},this.gui.config.mapsOverlay,{paths:[[]],editable:true});var polygon=new google.maps.Polygon(opt);var path=polygon.getPath();$view.data('polygon',polygon);var markers=new google.maps.MVCArray();$view.data('markers',markers);var mc=1;this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){path.push(ev.latLng);});google.maps.event.addListener(path,'insert_at',function(i){var marker=new google.maps.Marker({map:map,position:path.getAt(i),draggable:true,icon:self.gui.config.mapsMarker,zIndex:mc++});markers.insertAt(i,marker);if(path.getLength()>=3){polygon.setMap(map);}
var instr=(path.getLength()<=3)?path.getLength():3;$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[instr]);self.exec('geo_polygon','updateInfo',[$view,polygon]);$view.find('.jcsdl-clear-map').fadeIn();google.maps.event.addListener(marker,'position_changed',function(ev){var p=self.exec('geo_polygon','getMarkerIndex',[marker,markers]);if(p==-1)return;path.setAt(p,this.getPosition());self.exec('geo_polygon','updateInfo',[$view,polygon]);});google.maps.event.addListener(marker,'dblclick',function(ev){var p=self.exec('geo_polygon','getMarkerIndex',[marker,markers]);if(p==-1)return;path.removeAt(p);markers.removeAt(p);this.setMap(null);self.exec('geo_polygon','updateInfo',[$view,polygon]);});});google.maps.event.addListener(path,'set_at',function(i){var mark=markers.getAt(i),pos=path.getAt(i);if(!mark.getPosition().equals(pos)){mark.setPosition(pos);}});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();markers.forEach(function(marker,i){marker.setMap(null);});markers.clear();path.clear();self.exec('geo_polygon','updateInfo',[$view,polygon]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this;var $geoView=$view.find('.jcsdl-input-geo');val=val.split(':');setTimeout(function(){var polygon=$geoView.data('polygon');var map=$geoView.data('map');$.each(val,function(i,v){v=v.split(',');var pos=new google.maps.LatLng(parseFloat(v[0]),parseFloat(v[1]));polygon.getPath().push(pos);});map.fitBounds(polygon.getBounds());self.exec('geo_polygon','updateInfo',[$geoView,polygon]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[3]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var pth=$view.find('.jcsdl-input-geo').data('polygon').getPath(),v=[];pth.forEach(function(p,i){v.push(p.lat()+','+p.lng());});return v.join(':');},displayValue:function(info,val,filter){val=val.split(':');var output=[];$.each(val,function(i,v){v=v.split(',');output.push(parseFloat(v[0]).format(2)+', '+parseFloat(v[1]).format(2));if(i==1)return false;});output=output.join(' : ');if(val.length>2){output+=' and '+(val.length-2)+' more...';}
return output;},getMarkerIndex:function(mrk,mrks){var p=-1;mrks.forEach(function(m,k){if(m.getZIndex()==mrk.getZIndex())p=k;});return p;},updateInfo:function($view,polygon){var path=polygon.getPath();var $list=$view.find('.jcsdl-map-coordinates ul').html('');path.forEach(function(p,i){$('<li />').html('('+p.lat().format(4)+', '+p.lng().format(4)+')').appendTo($list);});if(path.getLength()>=3){var area=google.maps.geometry.spherical.computeArea(path);$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');}else{$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');}}}};

(function($){function JCSDLCarousel($el,options){var self=this;this.select=options.select;this.$carousel=$el.find('.jcsdl-carousel');this.$carouselWrap=this.$carousel.closest('.jcsdl-carousel-wrap');this.$carouselItems=this.$carousel.find('.jcsdl-carousel-item');this.$exampleItem=this.$carouselItems.eq(0);this.$scrollLeft=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.left');this.$scrollRight=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.right');this.itemsCount=this.$carouselItems.length;this.itemWidth=this.$exampleItem.outerWidth(true);this.itemMargin=parseInt(this.$exampleItem.css('marginRight'));this.margin=this.calculateCenterMargin();var $selected=this.$carouselItems.filter('.selected');this.selectedIndex=($selected.length==1)?$selected.prevAll().length:Math.floor(this.itemsCount/2);if(this.itemsCount%2==0){this.selectedIndex=this.selectedIndex-0.5;}
this.$carouselWrap.css({maxWidth:this.calculateWrapWidth(),height:this.$exampleItem.outerHeight(true)});this.$carousel.css({position:'relative',left:this.calculateCurrentPosition(),width:this.itemWidth*this.itemsCount,height:this.$exampleItem.outerHeight(true)});this.changePosition(0,!options.expand);this.$carouselWrap.siblings('.jcsdl-carousel-scroll').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $scroll=$(this);if($scroll.hasClass('inactive'))return;var changeIndex=$scroll.is(self.$scrollLeft)?-1:1;if(self.selectedIndex-Math.floor(self.selectedIndex)==0.5){self.selectedIndex=(changeIndex<0)?self.selectedIndex:self.selectedIndex-1;}
self.selectedIndex=Math.round(self.selectedIndex)+changeIndex;self.changePosition(options.speed);});this.$carouselItems.bind('mousedown.jcsdlcarousel touchstart.jcsdlcarousel',function(ev){ev.preventDefault();ev.target.blur();var $el=$(this);var moving=false;var pageX=(ev.type=='touchmove')?ev.originalEvent.targetTouches[0].pageX:ev.pageX;$('body').bind('mousemove.jcsdlcarousel touchmove.jcsdlcarousel',function(ev){moving=true;var evPageX=(ev.type=='touchmove')?ev.originalEvent.targetTouches[0].pageX:ev.pageX;var curLeft=parseInt(self.$carousel.css('left'));self.$carousel.css('left',curLeft-(pageX-evPageX));pageX=evPageX;});$('body').bind('mouseup.jcsdlcarousel touchend.jcsdlcarousel',function(ev){if(moving){self.snapToSelection();}else{self.selectedIndex=$el.prevAll().length;self.changePosition(options.speed);moving=false;}
$('body').unbind('mousemove.jcsdlcarousel touchmove.jcsdlcarousel');$('body').unbind('mouseup.jcsdlcarousel touchend.jcsdlcarousel');});});this.$carouselItems.bind('jcsdlclick',function(ev){$(this).trigger('mousedown').trigger('mouseup');});this.$carouselItems.click(function(ev){ev.preventDefault();ev.target.blur();if($.browser.msie){self.selectedIndex=$(this).prevAll().length;self.changePosition(options.speed);}});$(window).resize(function(ev){self.adjust();});if(this.$carouselItems.filter(':visible').length==1){this.$carouselItems.filter(':visible').trigger('jcsdlclick');}}
JCSDLCarousel.prototype={calculateWrapWidth:function(){return this.$carouselWrap.closest('.jcsdl-step').width()-this.$scrollLeft.outerWidth(true)-this.$scrollRight.outerWidth(true);},calculateCenterMargin:function(){this.margin=(this.$carouselWrap.width()-this.itemWidth+this.itemMargin)/2;return this.margin;},calculateCurrentPosition:function(){return-1*this.itemWidth*this.selectedIndex+this.margin;},toggleScrollButtons:function(){this.$scrollLeft.removeClass('inactive');this.$scrollRight.removeClass('inactive');if(this.selectedIndex==0)this.$scrollLeft.addClass('inactive');if(this.selectedIndex+1==this.itemsCount)this.$scrollRight.addClass('inactive');},getSelectedItem:function(){return this.$carouselItems.eq(this.selectedIndex);},snapToSelection:function(){var position=parseInt(this.$carousel.css('left'));this.selectedIndex=Math.round((position-this.margin)/(-1*this.itemWidth));this.selectedIndex=(this.selectedIndex<0)?0:this.selectedIndex;this.selectedIndex=(this.selectedIndex+1>this.itemsCount)?this.itemsCount-1:this.selectedIndex;this.changePosition(100);},changePosition:function(speed,dontExpand){var self=this;this.$carousel.animate({left:this.calculateCurrentPosition()},speed,function(){self.adjust();});this.toggleScrollButtons();if(!dontExpand&&typeof(this.select)=='function'){this.select.apply(this.getSelectedItem());}},adjust:function(){this.$carouselWrap.css({maxWidth:this.calculateWrapWidth()});this.calculateCenterMargin();this.$carousel.css({left:this.calculateCurrentPosition()});}};$.fn.jcsdlCarousel=function(options){function get($el){var carousel=$el.data('jcsdlCarousel');if(!carousel){carousel=new JCSDLCarousel($el,options);$el.data('jcsdlCarousel',carousel);}
return carousel;}
if(typeof(options)=='string'){if($.inArray(options,['adjust'])>=0){this.each(function(){var carousel=get($(this));carousel[options].apply(carousel,[]);});}
return this;}
options=$.extend({},{select:function(){},expand:false,speed:200},options);this.each(function(){get($(this));});return this;};})(window.jQuery);(function($){$.fn.jcsdlNumberMask=function(fl,arr){this.each(function(){$(this).keydown(function(ev){if((ev.which==190||ev.which==110)&&(($(this).val().indexOf('.')>=0)||!fl)){ev.preventDefault();return;}
if(ev.shiftKey||ev.altKey){ev.preventDefault();return;}else if(ev.which==46||ev.which==8||ev.which==9||ev.which==27||ev.which==190||ev.which==110||(ev.which==188&&arr)||(ev.which==65&&ev.ctrlKey===true)||(ev.which>=35&&ev.which<=39)||ev.which==13){return;}else{if((ev.which<48||ev.which>57)&&(ev.which<96||ev.which>105)){ev.preventDefault();}}});});return this;};})(window.jQuery);(function($){$.fn.jcsdlOrigVal=$.fn.val;$.fn.val=function(value){if(!this[0])return undefined;var $self=$(this[0]);if($self.data('jcsdlTagInput')){if(typeof(value)!=='undefined'){$self.jcsdlOrigVal(value);$self.trigger('change');return $self;}}
if(typeof(value)!=='undefined'){return $self.jcsdlOrigVal(value);}
return $self.jcsdlOrigVal();};function JCSDLTagInput($el,options){var self=this;this.delimeter=options.delimeter;this.numbers=options.numbers;this.floats=options.floats;this.$original=$el;this.$original.data('jcsdlTagInputEnabled',true);this.$wrap=$(this.tpl);this.$inputWrap=this.$wrap.find('.jcsdl-tag-field');this.$input=this.$inputWrap.find('input');this.inputPh=this.$original.attr('placeholder');this.$input.attr('placeholder',this.inputPh);this.$original.hide().data('jcsdlTagValue',[]);this.$wrap.insertAfter(this.$original);this.$inputSizeHelper=$('<div />').addClass('jcsdl-tag-field-helper').css({position:'absolute',left:-9999,bottom:-9999,minWidth:100,width:'auto',textAlign:'left'}).appendTo(this.$inputWrap);if(this.numbers){this.$input.jcsdlNumberMask(this.floats,true);}
this.update();this.$wrap.bind('click touchstart',function(ev){self.$input.focus();});this.$original.bind('change.jcsdltaginput',function(ev){if(self.updating||!$(this).data('jcsdlTagInputEnabled'))return;self.update();});this.$input.blur(function(ev){var val=self.$input.val();if(val.length==0)return;self.addTag(val);});this.$input.bind('paste.jcsdltaginput',function(ev){setTimeout(function(){var val=self.$input.val();if(val.length==0)return;self.addTag(val);},10);});this.$input.bind('keypress.jcsdltaginput',function(ev){var val=$(this).val();if(ev.which==13){ev.preventDefault();self.addTag($(this).val());return;}
self.reposition();});this.$input.bind('keydown.jcsdltaginput',function(ev){if(ev.which==8&&$(this).val().length==0){ev.preventDefault();self.removeTag(self.$wrap.find('.jcsdl-tag:last'));}});this.$input.bind('keyup.jcsdltaginput',function(ev){var val=$(this).val();if(val.charCodeAt(val.length-1)==self.delimeter.charCodeAt(0)){if(val.charAt(val.length-2)=='\\')return;self.addTag(val.substr(0,val.length-1));}});}
JCSDLTagInput.prototype={tpl:['<div class="jcsdl-tag-input">','<div class="jcsdl-tag-field">','<input type="text" />','</div>','</div>'].join(''),tagTpl:['<span class="jcsdl-tag">','<span />','<a href="#" class="jcsdl-tag-remove" title="Remove"></a>','</span>'].join(''),updating:false,delimeter:',',numbers:false,numbersArrVal:[],floats:false,addTag:function(val){this.$input.val('');if(typeof(val)=='undefined'||val.length==0)return;var self=this;var $tag=$(this.tagTpl);$tag.find('span').html(val.truncate());$tag.insertBefore(this.$inputWrap);var values=this.$original.data('jcsdlTagValue');values.push(val);this.$original.data('jcsdlTagValue',values);this.$original.val(values.join(this.delimeter));this.$input.attr('placeholder','');$tag.find('a').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.removeTag($tag);});this.reposition();},removeTag:function($tag){if($tag.length==0)return;var i=this.$wrap.find('.jcsdl-tag').index($tag);$tag.remove();var values=this.$original.data('jcsdlTagValue');values.splice(i,1);this.$original.data('jcsdlTagValue',values);this.$original.val(values.join(this.delimeter));if(values.length==0){this.$input.attr('placeholder',this.inputPh);}
this.reposition();},update:function(space){var delimeter=(space)?new RegExp(/[\s,]+/g):this.delimeter;var origVal=this.$original.val();if(origVal.length==0)return;var self=this;this.$original.data('jcsdlTagValue',[]);this.$wrap.find('.jcsdl-tag').remove();this.updating=true;var values=origVal.split(delimeter);var fixedValues=[];$.each(values,function(i,val){if(typeof(val)=='undefined')return true;if(val.charAt(val.length-1)=='\\'){val+=self.delimeter+values[i+1];values.splice(i+1,1);}
fixedValues.push(val);});values=fixedValues;$.each(values,function(i,val){self.addTag(val);});this.updating=false;this.reposition();},reposition:function(){var text=this.$input.val().escapeHtml();if(text.length==0)text=this.$input.attr('placeholder');this.$inputSizeHelper.html(text);this.$input.css({width:this.$inputSizeHelper.width()+32+'px',maxWidth:this.$wrap.width()-30,'font-size':this.$input.css('font-size'),'font-family':this.$input.css('font-family'),'font-weight':this.$input.css('font-weight'),'letter-spacing':this.$input.css('letter-spacing'),whiteSpace:'nowrap'});},enable:function(){if(this.numbers){if(!this.$original.data('jcsdlTagInputEnabled')){this.numbersArrVal[0]=this.$original.val();}else{this.numbersArrVal=this.$original.val().split(this.delimeter);}}
this.$original.data('jcsdlTagInputEnabled',true);if(this.numbers){this.$original.val(this.numbersArrVal.join(this.delimeter));}
this.$original.hide();this.$wrap.show();},disable:function(){if(this.numbers){var val='';if(this.$original.data('jcsdlTagInputEnabled')){this.numbersArrVal=this.$original.val().split(this.delimeter);val=this.numbersArrVal[0];}else{val=this.$original.val();}}
this.$original.data('jcsdlTagInputEnabled',false);if(this.numbers){this.$original.val(val);}
this.$original.show();this.$wrap.hide();}};$.fn.jcsdlTagInput=function(options){function get($el){var tagInput=$el.data('jcsdlTagInput');if(!tagInput){tagInput=new JCSDLTagInput($el,options);$el.data('jcsdlTagInput',tagInput);}
return tagInput;}
if(typeof(options)=='string'){if($.inArray(options,['enable','disable','reposition','update','setDelimeter'])>=0){var argmns=[];$.each(arguments,function(i,arg){if(i==0)return true;argmns.push(arg);});this.each(function(){var tagInput=get($(this));tagInput[options].apply(tagInput,argmns);});}
return this;}
options=$.extend({},{delimeter:',',numbers:false,floats:false},options);this.each(function(){get($(this));});return this;};})(window.jQuery);(function($){function JCSDLRegExTester($el,config){var self=this;this.$el=$el;this.exp=new RegExp();this.$btn=$('<a href="#" class="jcsdl-regex-tester-button">Test</a>').insertAfter(this.$el);this.$wrap=$('<div class="jcsdl-regex-tester"><p>If you want to test whether your regular expression correctly matches the desired strings, click the "Test" button and input example content in the shown field.</p></div>').insertAfter(this.$el).hide();this.$fields=$();this.$fieldsWraps=$();for(var i=1;i<=config.fields;i++){var $field=this.$el.clone().show().attr('placeholder','Test your expression against this field...');var $fieldBtn=$('<a href="#" class="jcsdl-regex-tester-button" />');var $fieldWrap=$('<div class="jcsdl-regex-tester-input-wrap" />').html($field).append($fieldBtn).append('<div class="jcsdl-regex-result" />');$fieldWrap.prependTo(this.$wrap);this.$fields=this.$fields.add($field);this.$fieldsWraps=this.$fieldsWraps.add($fieldWrap);$fieldBtn.bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.val=self.$el.val();self.test($field);});}
this.$btn.bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.$fieldsWraps.fadeIn();$(this).addClass('active');});this.$el.bind('keyup change',function(ev){self.val=self.$el.val();self.test();});this.$fields.bind('keyup',function(ev){self.test($(this));});this.disable();};JCSDLRegExTester.prototype={mode:'partial',val:'',test:function($fields){var self=this;var $fields=(typeof($fields)!=='undefined')?$fields:this.$fields;var pattern=this.val.replace(/\//g,'\/');var exp=(this.mode=='partial')?''+pattern+'':'^'+pattern+'$';this.exp=new RegExp(exp,'i');$fields.each(function(i,field){var result=(self.exp.test($(field).val()))?'ok':'err';$(field).siblings('.jcsdl-regex-result').removeClass('ok err').addClass(result).fadeIn();});},enable:function(){this.$el.data('jcsdlRegExTesterEnabled',true);this.$el.addClass('jcsdl-regex-active');this.$wrap.fadeIn();this.$btn.fadeIn();},disable:function(){this.$el.data('jcsdlRegExTesterEnabled',false);this.$el.removeClass('jcsdl-regex-active');this.$wrap.hide();this.$fieldsWraps.hide();this.$btn.hide();},setPartial:function(){this.mode='partial';},setExact:function(){this.mode='exact';}};$.fn.jcsdlRegExTester=function(options){function get($el){var tester=$el.data('jcsdlRegExTester');if(!tester){tester=new JCSDLRegExTester($el,options);$el.data('jcsdlRegExTester',tester);}
return tester;}
if(typeof(options)=='string'){if($.inArray(options,['enable','disable','setPartial','setExact','test'])>=0){this.each(function(){var tester=get($(this));tester[options].apply(tester,[]);});}
return this;}
options=$.extend({},{fields:1},options);this.each(function(){get($(this));});return this;}})(window.jQuery);(function($){var JCSDLPopup=function(config){var self=this;this.config=$.extend({},this.config,config);this.$overlay=$('<div class="jcsdl-overlay" />').appendTo('body').hide();this.$popup=$(['<div class="jcsdl-popup">','<div class="jcsdl-popup-header">','<h4 />','<a href="#" class="jcsdl-popup-close">Close</a>','</div>','<div class="jcsdl-popup-content" />','</div>'].join('')).appendTo('body').hide();if(this.config.title)this.setTitle(this.config.title);if(this.config.content)this.setContent(this.config.content);this.$popup.css({minWidth:this.config.minWidth,maxWidth:this.config.maxWidth});this.setWidth(this.config.width);if(this.config.autoshow)this.show();this.$popup.find('.jcsdl-popup-close').click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();self.close();});$(window).resize(function(ev){if(self.$popup.is(':visible')){self.reposition();}});};JCSDLPopup.prototype={$popup:$(),$overlay:$(),config:{width:700,minWidth:280,maxWidth:'70%',title:'',content:'<div class="jcsdl-popup-loading"></div>',autoshow:true,overlay:true},getTitle:function(){return this.$popup.find('.jcsdl-popup-header h4').html();},setTitle:function(title){this.$popup.find('.jcsdl-popup-header h4').html(title);this.config.title=title;},getContent:function(){return this.$popup.find('.jcsdl-popup-content');},setContent:function(content){var $content=$(content);var $popupContent=this.$popup.find('.jcsdl-popup-content');$popupContent.html('');$content.each(function(i,el){$popupContent.append($(el));});this.config.content=content;},setWidth:function(width){this.$popup.width(width);},reposition:function(){this.$popup.css('position','absolute');this.$popup.find('.jcsdl-popup-content').css('maxHeight',$(window).height()*0.7);var leftPos=($(window).width()-this.$popup.outerWidth())/2+$(window).scrollLeft();var topPos=($(window).height()-this.$popup.outerHeight())/2+$(window).scrollTop();if(topPos<0)topPos=0;if(leftPos<0)leftPos=0;this.$popup.css({left:leftPos+'px',top:topPos+'px'});},show:function(){if(this.config.overlay)this.$overlay.show();this.$popup.show();this.reposition();},hide:function(){this.$overlay.hide();this.$popup.hide();},close:function(){this.$overlay.remove();this.$popup.remove();}};$.jcsdlPopup=function(config){return new JCSDLPopup(config);};})(window.jQuery);var jcsdlMapsLoaded=false;var jcsdlMapsCurrentGui=null;var jcsdlMapsCurrentCallback=function(){};var jcsdlMapsCurrentCallbackArgs=[];var jcsdlMapsOptions={};var loadGoogleMapsApi=function(currentGui,callback,callbackArgs){jcsdlMapsCurrentGui=currentGui;jcsdlMapsCurrentCallback=callback;jcsdlMapsCurrentCallbackArgs=callbackArgs;if(!jcsdlMapsLoaded){var incKey=(jcsdlMapsCurrentGui.config.googleMapsApiKey.length>0)?'key='+jcsdlMapsCurrentGui.config.googleMapsApiKey+'&':'';var incProtocol=(window.location.protocol=='file:')?'http:':'';$('body').append('<script type="text/javascript" src="'+incProtocol+'//maps.googleapis.com/maps/api/js?'+incKey+'libraries=places,geometry&sensor=false&callback=jcsdlMapsInit" />');jcsdlMapsLoaded=true;}else{jcsdlMapsInit();}};var jcsdlMapsInit=function(){jcsdlMapsOptions={center:new google.maps.LatLng(40,0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(latLng){var bounds=new google.maps.LatLngBounds();var paths=this.getPaths();var path;for(var p=0;p<paths.getLength();p++){path=paths.getAt(p);for(var i=0;i<path.getLength();i++){bounds.extend(path.getAt(i));}}
return bounds;};}
if(jcsdlMapsCurrentGui&&jcsdlMapsCurrentCallback){setTimeout(function(){jcsdlMapsCurrentCallback.apply(jcsdlMapsCurrentGui.inputs,jcsdlMapsCurrentCallbackArgs);},jcsdlMapsCurrentGui.config.animate+10);}};$.extend(String.prototype,{truncate:function(l,a,h){l=l||72;a=a||'...';if(this.length<=l)return this.valueOf();s=this.substr(0,l);if(!h){s=s.substr(0,s.lastIndexOf(' '));}
return s+a;},escapeHtml:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');},unescapeHtml:function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');},escapeCsdl:function(){return this.replace(/\\(?![,:]+)/g,'\\\\').replace(/"/g,'\\"');},unescapeCsdl:function(){return this.replace(/\\"/g,'"').replace(/\\\\/g,'\\');}});$.extend(Number.prototype,{format:function(decimals,dec_point,thousands_sep){var number=this.toString().replace(/[^0-9+\-Ee.]/g,'');var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(typeof thousands_sep==='undefined')?',':thousands_sep,dec=(typeof dec_point==='undefined')?'.':dec_point,s='',toFixedFix=function(n,prec){var k=Math.pow(10,prec);return''+Math.round(n*k)/k;};s=(prec?toFixedFix(n,prec):''+Math.round(n)).split('.');if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep);}
if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join('0');}
return s.join(dec);}});

var JCSDLGui=function(el,cfg){var $el=$(el);if($el.length==0)return false;this.$el=$el.eq(0);var self=this;this.$container=$();this.config=$.extend(true,{animate:200,cancelButtton:true,googleMapsApiKey:'',mapsOverlay:{strokeWeight:0,fillColor:'#7585dd',fillOpacity:0.5},mapsMarker:'jcsdl/img/maps-marker.png',hideTargets:[],definition:{},save:function(code){},cancel:function(){self.$container.hide();}},cfg);this.definition=$.extend(true,JCSDLDefinition,this.config.definition);this.parser=new JCSDLParser(this);this.inputs=new JCSDLGuiInputs(this);this.logic='AND';this.filters=[];this.currentFilterIndex=null;this.currentFilterSteps=[];this.currentFilterTarget=null;this.currentFilterFieldsPath=[];this.$mainView=$();this.$filtersList=$();this.$currentFilterView=$();this.init();};JCSDLGui.prototype={jsonpCache:{operators:{},targets:{}},init:function(){var self=this;this.logic='AND';this.filters=[];this.currentFilterIndex=null;this.currentFilterSteps=[];this.currentFilterTarget=null;this.currentFilterFieldsPath=[];this.$currentFilterView=$();this.$currentFilterStepsView=$();this.$mainView=this.getTemplate('editor');this.$filtersList=this.$mainView.find('.jcsdl-filters-list');this.$container=this.getTemplate('container');this.$container.html(this.$mainView);this.$el.html(this.$container);if(!this.config.cancelButton){this.$mainView.find('.jcsdl-editor-cancel').hide();}
if($.browser.msie){this.$container.addClass('msie');}
this.$mainView.find('.jcsdl-filters-logic input[name="logic"]').change(function(ev){self.logic=$(this).val();});this.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $item=$(this);self.$filtersList.removeClass('expanded collapsed');self.$filtersList.addClass($item.data('mode'));self.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').removeClass('active');$item.addClass('active');});this.$mainView.find('.jcsdl-add-filter').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.showFilterEditor();});this.$mainView.find('.jcsdl-editor-save').bind('click.jcsdl touchstart',function(ev){ev.preventDefault();ev.target.blur();self.returnJCSDL();});this.$mainView.find('.jcsdl-editor-cancel').bind('click.jcsdl touchstart',function(ev){ev.preventDefault();ev.target.blur();self.config.cancel.apply(self,[]);});},reset:function(){this.init();},loadJCSDL:function(code){this.init();var self=this;var parsed=this.parser.parseJCSDL(code);if(parsed===false){this.showError('Invalid JCSDL input!',code);return;}
this.logic=(parsed.logic=='AND')?'AND':'OR';this.filters=parsed.filters;this.$mainView.find('.jcsdl-filters-logic input[name="logic"][value="'+this.logic+'"]').click();$.each(this.filters,function(i,filter){var $filterRow=self.createFilterRow(filter);$filterRow.appendTo(self.$filtersList);});this.$mainView.find('.jcsdl-editor-cancel').show();},returnJCSDL:function(){var code=this.parser.getJCSDLForFilters(this.filters,this.logic);this.config.save.apply(this,[code]);},showFilterEditor:function(filter,filterIndex){var self=this;this.$mainView.hide();this.$currentFilterView=this.getTemplate('filterEditor');this.$currentFilterStepsView=this.$currentFilterView.find('.jcsdl-steps');this.$currentFilterView.appendTo(this.$container);this.$currentFilterView.show();this.initFilterEditor();if(typeof(filter)!=='undefined'&&filter){this.currentFilterIndex=filterIndex;var fieldInfo=this.parser.getFieldInfo(filter.target,filter.fieldPath);this.$currentFilterView.find('.jcsdl-filter-target .target-'+filter.target).trigger('jcsdlclick');$.each(filter.fieldPath,function(i,field){var $fieldView=self.$currentFilterView.find('.jcsdl-filter-target-field:last');$fieldView.find('.field-'+field).trigger('jcsdlclick');});if(typeof(fieldInfo.input)!=='string'){this.$currentFilterView.find('.jcsdl-filter-target-field-input .input-'+filter.operator).trigger('jcsdlclick');}
if(fieldInfo.input=='text'){$('.jcsdl-dropdown .jcsdl-dropdown-option.operator-'+filter.operator).click();}else{this.$currentFilterView.find('.jcsdl-filter-value-input-operators .operator-'+filter.operator).click();}
var $valueInputView=this.$currentFilterView.find('.jcsdl-filter-value-input-field');this.setValueForField($valueInputView,fieldInfo,filter.value,filter.operator);if(filter.cs){this.$currentFilterView.find('.jcsdl-operator-cs').click();}}},initFilterEditor:function(filter,filterIndex){var self=this;var $targetSelectView=this.createTargetSelectView();this.addFilterStep('target',$targetSelectView);this.$currentFilterView.find('.jcsdl-filter-save').hide();this.$currentFilterView.find('.jcsdl-footer span').hide();this.$currentFilterView.find('.jcsdl-filter-save').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.didSubmitFilter();});this.$currentFilterView.find('.jcsdl-filter-cancel').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.hideFilterEditor();});},hideFilterEditor:function(){var self=this;this.currentFilterIndex=null;this.currentFilterSteps=[];this.currentFilterTarget=null;this.currentFilterFieldsPath=[];this.$currentFilterView.fadeOut(this.config.animate,function(){self.$currentFilterView.remove();self.$mainView.show();});},deleteFilter:function(index){this.$filtersList.find('.jcsdl-filter').eq(index).remove();this.filters.splice(index,1);},addFilterStep:function(stepName,$view,slide){var self=this;var slide=(typeof(slide)=='undefined')?true:slide;var $stepView=this.getTemplate('step');$stepView.html($view);var stepNumber=this.currentFilterSteps.length;$stepView.data('number',stepNumber);$stepView.addClass('jcsdl-filter-step-number-'+stepNumber);$stepView.data('name',stepName);$stepView.addClass('jcsdl-filter-step-'+stepName);$stepView.appendTo(this.$currentFilterStepsView);if(stepName=='target'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);$stepView.addClass('selected');$stepView.find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectTarget($item.data('name'));}});}
if(stepName=='field'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);self.$currentFilterStepsView.find('.jcsdl-filter-step-target').addClass('field-selected');var previousStep=$stepView.data('number')-1;self.$currentFilterStepsView.find('.jcsdl-filter-step-field.jcsdl-filter-step-number-'+previousStep).addClass('field-selected');$stepView.addClass('selected');$stepView.find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectField($item.data('name'),$view,$stepView);}});}
if(stepName=='input'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);var previousStep=$stepView.data('number')-1;self.$currentFilterStepsView.find('.jcsdl-filter-step-field.jcsdl-filter-step-number-'+previousStep).addClass('field-selected');$stepView.addClass('selected');$stepView.find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectInput($item.data('name'),$view,$stepView);}});}
if(stepName=='value'){this.$currentFilterView.find('.jcsdl-filter-save').fadeIn(this.config.animate);this.$currentFilterView.find('.jcsdl-footer span').show();}
if(slide){$stepView.hide().slideDown(this.config.animate);}else{if(stepName=='field'){$stepView.find('.jcsdl-filter-target-field').hide().fadeIn(this.config.animate);}else{$stepView.hide().fadeIn(this.config.animate);}}
setTimeout(function(){self.$currentFilterStepsView.find('.jcsdl-step').jcsdlCarousel('adjust');},this.config.animate);this.currentFilterSteps.push($stepView);},removeFilterStepsAfterPosition:function(position){var $theStep=this.$currentFilterStepsView.find('.jcsdl-step').eq(position);$theStep.removeClass('field-selected');this.$currentFilterView.find('.jcsdl-filter-save').hide();this.$currentFilterView.find('.jcsdl-footer span').hide();var steps=this.currentFilterSteps.splice(position+1,this.currentFilterSteps.length-position);var firstName='';$.each(steps,function(i,step){var $step=$(step);if(i==0){firstName=$step.data('name');}
$step.remove();});return firstName;},didSelectTarget:function(targetName){if(typeof(this.definition.targets[targetName])=='undefined')return false;this.currentFilterTarget=targetName;this.currentFilterFieldsPath=[];var firstRemoved=this.removeFilterStepsAfterPosition(0);var $fieldView=this.createFieldSelectionView(this.definition.targets[targetName].fields);this.addFilterStep('field',$fieldView,(firstRemoved!='field'));},didSelectField:function(fieldName,$fieldView,$stepView){var fieldPosition=$fieldView.data('position');this.currentFilterFieldsPath.splice(fieldPosition,this.currentFilterFieldsPath.length-fieldPosition);var field=this.getFieldInfoAtCurrentPath(fieldName);if(field==false)return;var firstRemoved=this.removeFilterStepsAfterPosition($fieldView.closest('.jcsdl-step').data('number'));this.currentFilterFieldsPath.push(fieldName);if(typeof(field.fields)!=='undefined'){var $fieldView=this.createFieldSelectionView(field.fields);var slide=(firstRemoved!='field');this.addFilterStep('field',$fieldView,slide);return;}
if(typeof(field.input)!=='string'){var $inputView=this.createInputSelectionView(field.input);var slide=(firstRemoved!='input');this.addFilterStep('input',$inputView,slide);return;}
var $valueView=this.createValueInputView(field);this.addFilterStep('value',$valueView,(firstRemoved!='value'));},didSelectInput:function(inputName,$inputView,$stepView){var inputPosition=$inputView.data('position');var firstRemoved=this.removeFilterStepsAfterPosition($inputView.closest('.jcsdl-step').data('number'));var $valueView=this.createValueInputView(this.getFieldInfoAtCurrentPath(),inputName);this.addFilterStep('value',$valueView,(firstRemoved!='value'));},didSubmitFilter:function(){var fieldInfo=this.getFieldInfoAtCurrentPath();var operator=(fieldInfo.input=='text')?this.$currentFilterView.find('.jcsdl-filter-value-input-operators .jcsdl-operators-select').data('operator'):this.$currentFilterView.find('.jcsdl-filter-value-input-operators .operator.selected').data('name');if(typeof(operator)=='undefined'){this.showError('You need to select an operator!');return;}
var value='';if(operator!=='exists'){var $valueView=this.$currentFilterView.find('.jcsdl-filter-value-input-field');value=this.getValueFromField($valueView,fieldInfo,operator);if(value.length==0){this.showError('You need to specify a value!');return;}}
var filter=this.parser.createFilter(this.currentFilterTarget,this.currentFilterFieldsPath,operator,value,{cs:((operator!=='exists')&&fieldInfo.cs&&this.$currentFilterView.find('.jcsdl-operator-cs.selected').length>0)?true:false});var $filterRow=this.createFilterRow(filter);if(this.currentFilterIndex!==null){this.$filtersList.find('.jcsdl-filter').eq(this.currentFilterIndex).replaceWith($filterRow);this.filters[this.currentFilterIndex]=filter;}else{$filterRow.appendTo(this.$filtersList);this.filters.push(filter);}
this.hideFilterEditor();},showError:function(message,code){this.$mainView.find('.jcsdl-error').remove();this.$currentFilterView.find('.jcsdl-error').remove();var $error=this.getTemplate('error');$error.find('span').html(message);if(this.$mainView.is(':visible')){$error.insertBefore(this.$mainView.find('.jcsdl-footer'));}else{$error.prependTo(this.$currentFilterView.find('.jcsdl-footer'));}
$error.hide().fadeIn();if(typeof(console)!=='undefined'){console.error(message,arguments);}},createFilterRow:function(filter){var self=this;var $filterRow=this.getTemplate('filter');var $target=this.getTemplate('filterTarget');var targetInfo=this.parser.getTargetInfo(filter.target);$target.addClass('selected target-'+filter.target).html(targetInfo.name);$filterRow.find('.target').html($target);var currentPath=[];$.each(filter.fieldPath,function(i,field){currentPath.push(field);var $field=self.getTemplate('filterField');var fieldInfo=self.parser.getFieldInfo(filter.target,currentPath);$field.addClass('selected icon-'+self.getIconForField(field,fieldInfo));$field.html(fieldInfo.name);$filterRow.find('.jcsdl-filter-info.field').append($field);});var field=this.parser.getFieldInfo(filter.target,currentPath);var $operator=this.getTemplate('filterOperator');$operator.addClass('operator-'+filter.operator+' icon-'+filter.operator+' selected').prop('title',this.definition.operators[filter.operator].description).html(this.definition.operators[filter.operator].code.escapeHtml()).tipsy({gravity:'s'});$filterRow.find('.operator').html($operator);if(filter.cs){var $cs=this.getTemplate('filterOperator');$cs.addClass('operator-cs icon-cs selected').prop('title','Case Sensitive').html('case sensitive').tipsy({gravity:'s'});$filterRow.find('.jcsdl-filter-info.operator').append($cs);}
if(filter.operator!=='exists'){var $value=$();var isGeo=($.inArray(filter.operator,['geo_box','geo_polygon','geo_radius'])>=0);var input=(isGeo)?filter.operator:field.input;if(isGeo){var $input=this.getTemplate('filterFieldInput');$input.find('.jcsdl-filter-field-input').addClass('selected icon-'+filter.operator);$input.insertAfter($filterRow.find('.jcsdl-filter-info.field'));$operator.remove();}
if(this.inputs[input]&&typeof(this.inputs[input].displayValue)=='function'){$value=this.inputs.exec(input,'displayValue',[field,filter.value,filter]);}else{$value=this.getTemplate('filterValue');$value.html(filter.value.truncate(50).escapeHtml());}
$filterRow.find('.value').addClass('input-'+input).html($value);$filterRow.find('.operator').addClass('input-'+input);}else{$filterRow.find('.value').remove();}
$filterRow.data('filter',filter);$filterRow.find('.edit').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var index=self.getFilterIndexByElement($filterRow);self.showFilterEditor(filter,index);});$filterRow.find('.delete').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var index=self.getFilterIndexByElement($filterRow);self.deleteFilter(index);});return $filterRow;},createTargetSelectView:function(){var self=this;var $targetSelectView=this.getTemplate('target');var $targetSelect=$targetSelectView.find('.jcsdl-filter-target');$.each(this.definition.targets,function(name,target){var $targetView=self.createOptionForTarget(name,target);$targetView.appendTo($targetSelect);if($.inArray(name,self.config.hideTargets)>=0){$targetView.hide().addClass('hidden');}});return $targetSelectView;},createOptionForTarget:function(name,target){var $option=this.getTemplate('targetOption');$option.data('name',name);$option.data('target',target);$option.addClass('target-'+name);return $option;},createFieldSelectionView:function(fields){var self=this;var $fieldView=this.getTemplate('field');var fieldPosition=this.currentFilterFieldsPath.length;$fieldView.data('position',fieldPosition);$fieldView.addClass('field-select-'+fieldPosition);var currentPath=this.currentFilterTarget+(this.currentFilterFieldsPath.length>0?'.'+this.currentFilterFieldsPath.join('.'):'');var $fieldSelect=$fieldView.find('.jcsdl-filter-target-field');$.each(fields,function(name,field){var $fieldView=self.createOptionForField(name,field);$fieldView.appendTo($fieldSelect);var hidden=false;var path=currentPath+'.'+name;if($.inArray(path,self.config.hideTargets)>=0)hidden=true;var sectionPath='';path=path.split('-');$.each(path,function(i,section){sectionPath+=(i>0?'.':'')+section;if($.inArray(sectionPath,self.config.hideTargets)>=0){hidden=true;return true;}});if(hidden){$fieldView.hide().addClass('hidden');}});return $fieldView;},createOptionForField:function(name,fieldInfo){var $option=this.getTemplate('fieldOption');$option.data('name',name);$option.data('field',fieldInfo);$option.html(fieldInfo.name);$option.addClass('icon-'+this.getIconForField(name,fieldInfo));$option.addClass('field-'+name);return $option;},createInputSelectionView:function(inputs){var self=this;var $inputView=this.getTemplate('inputSelect');var $inputSelect=$inputView.find('.jcsdl-filter-target-field-input');$.each(inputs,function(i,name){var $inputOptionView=self.createOptionForInput(name);$inputOptionView.appendTo($inputSelect);});return $inputView;},createOptionForInput:function(name){var $option=this.getTemplate('inputSelectOption');$option.data('name',name).addClass('icon-'+name+' input-'+name).html(name);return $option;},createValueInputView:function(field,inputType){var self=this;inputType=inputType||field.input;var $valueView=this.getTemplate('valueInput');if(typeof(this.inputs[inputType])=='undefined')return $valueView;var $inputView=this.inputs.exec(inputType,'init',[field]);var $input=$inputView.find('input:first');var $valueInput=$valueView.find('.jcsdl-filter-value-input-field');$valueInput.data('inputType',inputType).html($inputView);var $operatorsListView=$valueView.find('.jcsdl-filter-value-input-operators');if(inputType=='text'){this.createTextOperatorsSelectView($operatorsListView,field,inputType,$valueInput);}else{this.createOperatorsSelectView($operatorsListView,field,inputType,$valueInput);}
return $valueView;},createOperatorsSelectView:function($view,field,inputType,$inputView){var self=this;var $input=$inputView.find('input:first');var inputConfig=(typeof(this.definition.inputs[inputType])!=='undefined')?this.definition.inputs[inputType]:{};var allowedOperators=(typeof(inputConfig.operators)!=='undefined')?inputConfig.operators:[];$.each(field.operators,function(i,operator){if(allowedOperators.length>0&&($.inArray(operator,allowedOperators)==-1))return true;var $operatorView=self.createOperatorOptionView(operator);if($.browser.msie){$operatorView.html('&nbsp;');}
$view.append($operatorView);});$view.children().bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $operator=$(this);$view.children().removeClass('selected');$operator.addClass('selected');if($operator.data('name')=='exists'){$inputView.fadeOut(self.config.animate);}else if(!$inputView.is(':visible')){$inputView.fadeIn(self.config.animate);}
if(inputType=='number'){var opName=$operator.data('name');var tagAction=($.inArray(opName,inputConfig.arrayOperators)>=0)?'enable':'disable';$input.jcsdlTagInput(tagAction);}});if($view.children().length==1){$view.children().eq(0).click();$view.children().hide();}else{var preselect=(typeof(field.operator)!=='undefined')?field.operator:inputConfig.operator;var $preselect=$view.find('.operator-'+preselect);if($preselect.length>0){$preselect.click();}else{$view.find('.operator:not(.operator-exists):first').click();}}
return $view;},createTextOperatorsSelectView:function($view,field,inputType,$inputView){var self=this;$('.jcsdl-dropdown').remove();$view.addClass('text');var $input=$inputView.find('input.orig');var $select=this.getTemplate('textOperatorsSelect');var $dropdown=this.getTemplate('textOperatorsDropdown');var inputConfig=(typeof(this.definition.inputs[inputType])!=='undefined')?this.definition.inputs[inputType]:{};var allowedOperators=(typeof(inputConfig.operators)!=='undefined')?inputConfig.operators:[];$.each(field.operators,function(i,operator){if(allowedOperators.length>0&&($.inArray(operator,allowedOperators)==-1))return true;var $operatorView=self.createTextOperatorOptionView(operator);$dropdown.append($operatorView);});$view.html($select).insertAfter($inputView);$dropdown.hide().appendTo('body');if(field.cs){var $csView=this.getTemplate('caseSensitivity');$csView.bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();$(this).toggleClass('selected');}).tipsy({gravity:'s'});$csView.prependTo($view);$select.addClass('has-cs');}
$select.click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();if($select.hasClass('active')){$dropdown.slideUp(self.config.animate);$select.removeClass('active');}else{$dropdown.css({top:$select.offset().top+$select.outerHeight()-1,left:$select.offset().left,width:$select.outerWidth()-2}).slideDown(self.config.animate);$select.addClass('active');$('body').bind('click.jcsdldropdown',function(ev){var $parent=$(ev.target).closest('.jcsdl-dropdown');if($parent==null||!$parent.is($dropdown)){$select.removeClass('active');$dropdown.slideUp(self.config.animate);$('body').unbind('click.jcsdldropdown');}});}});$dropdown.find('.jcsdl-dropdown-details-trigger, .jcsdl-operator-help').click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();var $option=$(this).closest('.jcsdl-dropdown-option');var name=$option.data('name');var popup=$.jcsdlPopup({title:$option.data('title')});if(typeof(self.jsonpCache.operators[name])=='undefined'){$.ajax({url:$option.data('jsonp'),type:'GET',async:false,jsonpCallback:'jcsdlJSONP',contentType:'application/json',dataType:'jsonp',success:function(data){popup.setContent(data.html);popup.reposition();self.jsonpCache.operators[name]=data.html;}});}else{popup.setContent(self.jsonpCache.operators[name]);popup.reposition();}});$dropdown.find('.jcsdl-dropdown-option').click(function(ev){ev.preventDefault();ev.target.blur();$select.removeClass('active');$dropdown.hide();var name=$(this).data('name');var operator=self.definition.operators[name];$select.find('.jcsdl-operator-label').html(operator.label);$select.data('operator',name);if(name=='exists'){$inputView.fadeOut(self.config.animate);if(field.cs){$csView.fadeOut(self.config.animate);}}else if(!$inputView.is(':visible')){$inputView.fadeIn(self.config.animate);if(field.cs){$csView.fadeIn(self.config.animate);}}
if(name=='contains_near'){$inputView.find('.jcsdl-containsnear-distance').fadeIn();$inputView.find('.jcsdl-tag-field input').bind('keydown.nospace',function(ev){if(ev.which==32){ev.preventDefault();return;}});$input.jcsdlTagInput('update',true);$input.data('split',true);}else{$inputView.find('.jcsdl-containsnear-distance').hide();$inputView.find('.jcsdl-tag-field input').unbind('keydown.nospace');if($input.data('split')){$input.jcsdlTagInput('update');$input.data('split',false);}}
var tagAction=($.inArray(name,inputConfig.arrayOperators)>=0)?'enable':'disable';$input.jcsdlTagInput(tagAction);if(tagAction=='enable'){$input.jcsdlTagInput('update');}
var regExAction=($.inArray(name,['regex_partial','regex_exact'])>=0)?'enable':'disable';$input.jcsdlRegExTester(regExAction);if(regExAction=='enable'){var regExSetting=(name=='regex_partial')?'Partial':'Exact';$input.jcsdlRegExTester('set'+regExSetting);$input.jcsdlRegExTester('test');}});$(window).resize(function(ev){if(!$select.hasClass('active'))return;$dropdown.css({top:$select.offset().top+$select.outerHeight()-1,left:$select.offset().left,width:$select.outerWidth()-2});});if($dropdown.find('.jcsdl-dropdown-option').length==1){$dropdown.find('.jcsdl-dropdown-option:first').click();}else{var preselect=(typeof(field.operator)!=='undefined')?field.operator:inputConfig.operator;var $preselect=$dropdown.find('.jcsdl-dropdown-option.operator-'+preselect);if($preselect.length>0){$preselect.click();}else{$dropdown.find('.jcsdl-dropdown-option:not(.operator-exists):first').click();}}
return $view;},createOperatorOptionView:function(name){var operator=this.definition.operators[name];if(typeof(operator)=='undefined')return $();var $operatorView=this.getTemplate('operatorOption');$operatorView.data('name',name).addClass('icon-'+name+' operator-'+name).prop('title',operator.description).html(operator.label).tipsy({gravity:'s'});return $operatorView;},createTextOperatorOptionView:function(name){var operator=this.definition.operators[name];if(typeof(operator)=='undefined')return $();var $view=this.getTemplate('textOperatorOption');$view.data('name',name).data('title',operator.label).addClass('operator-'+name);$view.find('.jcsdl-icon').addClass('icon-'+name+' operator-'+name+' selected');$view.find('.jcsdl-operator-label span').html(operator.label);$view.find('.jcsdl-operator-desc').html(operator.description);if(operator.jsonp){$view.data('jsonp',operator.jsonp);}else{$view.find('.jcsdl-dropdown-details-trigger').remove();$view.find('.jcsdl-operator-help').remove();}
return $view;},setValueForField:function($view,fieldInfo,value,operator){var self=this;var inputType=$view.data('inputType');if(typeof(this.inputs[inputType])=='undefined')return false;if($.inArray(inputType,['geo_box','geo_radius','geo_polygon'])>=0){var mapsGui=jcsdlMapsCurrentGui;var mapsCallback=jcsdlMapsCurrentCallback;var mapsCallbackArgs=jcsdlMapsCurrentCallbackArgs;jcsdlMapsCurrentCallback=function(){if(mapsGui&&mapsCallback){setTimeout(function(){mapsCallback.apply(mapsGui.inputs,mapsCallbackArgs);self.inputs.exec(inputType,'setValue',[$view,fieldInfo,value,operator]);},mapsGui.config.animate+10);}};}else{this.inputs.exec(inputType,'setValue',[$view,fieldInfo,value,operator]);}
return true;},getValueFromField:function($view,fieldInfo,operator){var inputType=$view.data('inputType');if(typeof(this.inputs[inputType])=='undefined')return'';return this.inputs.exec(inputType,'getValue',[$view,fieldInfo,operator]);},getTemplate:function(name){if(typeof(JCSDLGuiTemplates[name])!=='undefined'){return JCSDLGuiTemplates[name].clone();}
return $();},getFieldInfoAtCurrentPath:function(newFieldName){var fieldsPath=this.currentFilterFieldsPath.slice(0);if(typeof(newFieldName)=='string'){fieldsPath.push(newFieldName);}
return this.parser.getFieldInfo(this.currentFilterTarget,fieldsPath);},getIconForField:function(field,fieldInfo){return(typeof(fieldInfo.icon)!=='undefined')?fieldInfo.icon:field;},getFilterIndexByElement:function($filterRow){return this.$filtersList.find('.jcsdl-filter').index($filterRow);}};
